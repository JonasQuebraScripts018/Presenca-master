<!doctype html>
<html lang="en" xmlns:th="http://wwwthymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
            integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
            crossorigin="anonymous"></script>
    <script src="ValidadorCPF.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js"
            integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
            integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <title>Cadastro</title>
</head>
<body>
<div class="container mt-5">
        <div id="errorMensage"></div>
        <h1 class="text-left">Cadastre-se</h1>
        <div class="input-group mb-3">
            <span class="input-group-text" id="sp_nome"><i class="fa-solid fa-user"></i></span>
            <input id="nome" name="nome" type="text" class="form-control" placeholder="Nome"
                   aria-label="nome" aria-describedby="sp_nome">
        </div>
        <div class="row">
            <div class="col-sm-12">
                <div class="input-group mb-3">
                    <span class="input-group-text" id="sp_email"><i class="fa-solid fa-envelope"></i></span>
                    <input id="email" name="email" type="text" class="form-control" placeholder="E-mail"
                           aria-label="email" aria-describedby="sp_email">
                </div>
            </div>
            <div class="col-sm-4">
                <div class="input-group mb-3">
                    <span class="input-group-text" id="sp_cpf"><i class="fa-solid fa-user-secret"></i></span>
                    <input id="cpf" name="cpf" type="text" class="form-control" placeholder="CPF"
                           aria-label="cpf" aria-describedby="sp_cpf">
                </div>
            </div>
            <div class="col-sm-4">
                <div class="input-group mb-3">
                    <span class="input-group-text" id="sp_telefone"><i class="fa-solid fa-phone"></i></span>
                    <input id="telefone" name="telefone" type="text" class="form-control" placeholder="Telefone"
                           aria-label="telefone" aria-describedby="sp_telefone">
                </div>
            </div>
            <div class="col-sm-4">
                <div class="input-group mb-3">
                    <span class="input-group-text" id="sp_dataNasc"><i class="fa-regular fa-calendar-days"></i></span>
                    <input id="dataNasc" name="dataNasc" type="date" class="form-control" placeholder="Data Nascimento"
                           aria-label="dataNasc" aria-describedby="sp_data">
                </div>
            </div>
            <div class="col-sm-6">
                <div class="input-group mb-3">
                    <span class="input-group-text" id="sp_senha"><i class="fa-solid fa-lock"></i></span>
                    <input id="senha" name="senha" type="password" class="form-control" placeholder="Senha"
                           aria-label="senha" aria-describedby="sp_senha">
                </div>
            </div>
            <div class="col-sm-6">
                <div class="input-group mb-3">
                    <span class="input-group-text" id="sp_confsenha"><i class="fa-solid fa-key"></i></span>
                    <input id="confsenha" name="confsenha" type="password" class="form-control"
                           placeholder="Confirmação senha"
                           aria-label="confsenha" aria-describedby="sp_confsenha">
                </div>
            </div>
            <div class="col-sm-12 text-right">
                <button id="enviar" class="btn btn-primary" onclick="validaEnvia()">Cadastrar-se</button>
            </div>
        </div>
</div>
<script type="text/javascript">
        function validaCampoVazio(campo){
        if(campo.trim() == ''){
            return true;
        }else{
            return false;
        }
        }

        function validaEnvia(){
           let Enviar = true;
           let nome = $("#nome").val();
           let cpf = $("#cpf").val();
           let email = $("#email").val();
           let data_nasc = $("#dataNasc").val();
           let telefone = $("#telefone").val();
           let senha = $("#senha").val();
           let confsenha = $("#confsenha").val();

        $("#errorMenssage").text('')
        if(validaCampoVazio(nome)){
            Enviar = false;
            $("#errorMensage").append("O Nome precisa ser preenchido<br/>");
        }
        if(validaCampoVazio(email) && validaCampoVazio(telefone)){
            Enviar = false;
            $("#errorMensage").append("O Email ou o Telefone precisa ser informado<br/>");
        }
        if(validaCampoVazio(data_nasc)){
            Enviar = false;
            $("#errorMensage").append("A Data de nascimento precisa ser informada<br/>");
        }
        if(validaCampoVazio(senha) || senha != confsenha){
            Enviar = false;
            $("#errorMensage").append("A Senha precisa ser informada e igual a Confirmação da Senha<br/>");
        }
        if(!validarCPF(cpf)){
            Enviar = false;
            $("#errorMensage").append("CPF Invalido<br/>");
        }
        if(Enviar){
        $.ajax({
            type: "POST",
            url: "/cadastro",
            data:{
                nome:nome,
                email:email,
                cpf:cpf,
                senha:senha,
                confsenha:confsenha,
                datanasc:data_nasc,
                telefone:telefone,
            },
            success: function(data){
            $("#errorMensage").text('')
                if(data.sucesso){
                alert("Deu bom meu nobre");
                }else{
                $("#errorMensage").append(data.mensagem);
                }
            },
            error: function(){
                alert("Deu ruim meu nobre");
            }
        });
        }
        }
</script>
</body>
</html>